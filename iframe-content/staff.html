<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Інформація про вчителя</title>
    <link rel="stylesheet" href="https://yehormovchan.github.io/static/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1 id="teacher-name"></h1>
    <div class="main-info">
        <div class="general">
            <div class="loader general-loader"></div>
            <div class="general-request-error request-error">Сталася помилка, спробуйте пізніше.</div>
            <span><strong>Посада:</strong> <span id="teacher-position"></span></span>
            <span><strong>Телефон:</strong> <span id="teacher-phone"></span></span>
            <span><strong>Номер паспорта:</strong> <span id="teacher-passport"></span></spa>
            <span><strong>Додаткова інформація:</strong> <span id="teacher-info"></span></span>
            <img id="passport-copy" src="" alt="Копія паспорта" style="max-width: 300px; display: none;">
        </div>
    </div>

    <button id="edit-teacher-button">Редагувати інформацію</button>
    
    <div id="edit-teacher-modal" class="modal hidden">
        <div class="edit-wrapper">
            <h2>Редагування інформації про вчителя</h2>
            <label>Ім'я: <input type="text" id="edit-teacher-name"></label><br>
            <label>Посада: <input type="text" id="edit-teacher-position"></label><br>
            <label>Телефон: <input type="text" id="edit-teacher-phone"></label><br>
            <label>Номер паспорта: <input type="text" id="edit-teacher-passport"></label><br>
            <label>Додаткова інформація: <textarea id="edit-teacher-info"></textarea></label><br>
            <label>Копія паспорта: <input type="file" id="upload-passport" accept="image/*"></label><br>
            <button id="save-teacher">Зберегти</button>
            <button onclick="$('#edit-teacher-modal').fadeOut()">Закрити</button>
        </div>
    </div>
    
    <script>
        $(document).ready(function() {
            let urlParams = new URLSearchParams(window.location.search);
            let teacherId = urlParams.get("id");
            
            if (teacherId) {
                $.getJSON(`http://localhost:8080/staff/${teacherId}`, function(teacher) {
                    $("#teacher-name").text(teacher.name);
                    $("#teacher-position").text(teacher.position);
                    $("#teacher-phone").text(teacher.phone || 'Немає даних');
                    $("#teacher-passport").text(teacher.passportNumber || 'Немає даних');
                    $("#teacher-info").text(teacher.info || 'Немає даних');
                    
                    if (teacher.passportCopy) {
                        $("#passport-copy").attr("src", `data:image/png;base64,${teacher.passportCopy}`).show();
                    }
                });
            }
            
            $("#edit-teacher-button").click(function() {
                $("#edit-teacher-modal").fadeIn();
            });
            
            $("#save-teacher").click(function() {
                let updatedData = {
                    id: teacherId,
                    name: $("#edit-teacher-name").val(),
                    position: $("#edit-teacher-position").val(),
                    phone: $("#edit-teacher-phone").val(),
                    passportNumber: $("#edit-teacher-passport").val(),
                    info: $("#edit-teacher-info").val()
                };
                
                let formData = new FormData();
                formData.append("teacher", new Blob([JSON.stringify(updatedData)], { type: "application/json" }));
                
                let fileInput = $("#upload-passport")[0].files[0];
                if (fileInput) {
                    let blob = new Blob([fileInput], { type: fileInput.type });
                    formData.append("passportCopy", blob, fileInput.name);
                }
                
                $.ajax({
                    url: `http://localhost:8080/staff/update/${teacherId}`,
                    method: "POST",
                    contentType: false,
                    data: formData,
                    cache: false,
                    processData: false,
                    success: () => location.reload(),
                    error: (errorMessage) => console.log("error" + errorMessage)
                });
            });
        });
    </script>
</body>
</html>
