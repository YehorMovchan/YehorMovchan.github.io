<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Адміністрування школи</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://yehormovchan.github.io/static/style.css">
    <script src="https://yehormovchan.github.io/static/script.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <nav>
                 <div class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1" id="navbar-sticky">
                    <ul class="flex flex-col p-4 md:p-0 mt-4 font-medium border border-gray-100 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">
                        <li>
                        <a href="#" class="block py-2 px-3 text-white bg-blue-700 rounded-sm md:bg-transparent md:text-blue-700 md:p-0 md:dark:text-blue-500" aria-current="page">Home</a>
                        </li>
                        <li>
                        <a href="#" class="block py-2 px-3 text-gray-900 rounded-sm hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">About</a>
                        </li>
                        <li>
                        <a href="#" class="block py-2 px-3 text-gray-900 rounded-sm hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Services</a>
                        </li>
                        <li>
                        <a href="#" class="block py-2 px-3 text-gray-900 rounded-sm hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Contact</a>
                        </li>
                    </ul>
                </div>
                <ul>
                    <li><a href="#" onclick="changePage(this)">Головна</a></li>
                    <li><a id="kid-list" href="#kid-list" onclick="changePage(this)">Учні</a></li>
                    <li><a id="staff-list" href="#staff-list"  onclick="changePage(this)">Працівники</a></li>
                    <li><a id="schedule" href="#schedule" onclick="changePage(this)">Розклад</a></li>
                    <li><a id="groups-list" href="#groups-type" onclick="changePage(this)">Гуртки</a></li>
                    <li><a id="programs-list" href="#programs-type" onclick="changePage(this)">Програми навчання</a></li>
                    <li><a id="staff-schedule" href="#staff-schedule" onclick="changePage(this)">Розклад</a></li>
                    <li><a id="personal-account" href="#personal-account" onclick="changePage(this)">Особистий кабінет</a></li>
                    <li><a id="settings" href="#settings" onclick="changePage(this)">Налаштування</a></li>
                </ul>
            </nav>
            <div class="user-info">
                <button class="sign-in" id="sign-in-button">Увійти</button>
                <span id="username" style="display: none;"></span>
                <button class="sign-in" id="sign-out" style="display: none;">Вийти</button>
            </div>
        </header>
        
        <main>
            <iframe id="iframe-content" src="" frameborder="0"></iframe>

            <div class="modal hidden" id="sign-in-modal">
                <div class="wrapper edit-wrapper">
                    <h2>Увійти</h2>
                    <span id="login-error" style="display: none;" class="login-error">Невірний логін або пароль</span>
                    <label>Логін: <br><input type="text" id="login" name="login" required></label><br>
                    <label>Пароль: <br>
                    <input type="password" id="password" name="password" required></label><br>
                    <button id="sign-in-modal-enter">Увійти</button>
                    <button id="sign-in-modal-close">Закрити</button>
                </div>
            </div>

        </main>
    </div>
   
    
    <!-- <footer>
        <p>&copy; 2025 Адміністрування школи</p>
    </footer> -->
</body>
<script>

    let iframe;
    let page = location.hash;
    const aList = $("a").toArray();
    aList.forEach(e=>{
        e.style.display = "none";
    })
    let links
    
    $(document).ready(()=>{
        iframe = $("#iframe-content")[0]
        getUserRole().then(role=>{
            if(!role){
                iframe.src = "";
                location.hash = "#";
                $("#sign-in-button").show();
                $("#username").hide();
                $("#sign-out").hide();
            }
            else{
                $.getJSON("https://yehormovchan.github.io/assets/permits.json", (data)=>{
                    let permits = data[role];
                   
                    aList.forEach(element => {
                        if(permits.includes(element.id)){
                            element.style.display = "block";
                        }
                    });
                })
            }
        })
        
        getUser().then(user=>{
            if(!user){
                $("#sign-in-button").show();
            }
            else{
                $("#sign-in-button").hide();
                $("#username").show();
                $("#username").text(user.username);
                $("#sign-out").show();
            }
        })

        $.getJSON("https://yehormovchan.github.io/assets/links.json", (data)=>{
            links = data;
            iframe.src=links[page];
        })
        

        $("#sign-in-button").click(()=>{
            $("#sign-in-modal").fadeIn();
        })
        $("#sign-in-modal-close").click(()=>{
            $("#sign-in-modal").fadeOut();
        })
        $("#sign-in-modal-enter").click(()=>{
            let username = $("#login").val();
            let password = $("#password").val();
            $.ajax({
            url: 'https://school-f6vi.onrender.com/auth/login',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ username: username, password: password }),
            success: function (response) {
                localStorage.setItem('token', response.token); // Зберігаємо токен
                location.reload();
            },
            error: function () {
                $("#login-error").show();
            }
        });
        })
        $("#sign-out").click(()=>{
            localStorage.removeItem('token');
            iframe.src = "";
            $("a").hide();
            $("#sign-in-button").show();
            $("#username").hide();
            $("#sign-out").hide();
        })

    })
    function changePage(el){
        iframe.src = links[el.hash];
    }



</script>
</html>
